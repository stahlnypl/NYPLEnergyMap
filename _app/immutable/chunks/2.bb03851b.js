import{s as Bt,n as st,o as vr,f as gr,b as mr}from"./scheduler.b108d059.js";import{S as Nt,i as Mt,g as ee,m as G,s as Oe,h as te,j as $e,n as J,c as Ae,f as ie,y as br,k as xe,a as ze,x as j,o as Ce,r as _r,u as wr,v as Sr,d as Tr,t as Er,w as kr}from"./index.bb499846.js";import{_ as W}from"./preload-helper.41c905a7.js";import"./paths.058d58e9.js";function Or(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ar=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const xr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ar(void 0,void 0,void 0,function*(){return yield(yield W(()=>Promise.resolve().then(()=>Ve),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class ht extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Cr extends ht{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Pr extends ht{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $r extends ht{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Rr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};class jr{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=xr(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Rr(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(_=>{throw new Cr(_)}),l=c.headers.get("x-relay-error");if(l&&l==="true")throw new Pr(c);if(!c.ok)throw new $r(c);let f=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),v;return f==="application/json"?v=yield c.json():f==="application/octet-stream"?v=yield c.blob():f==="multipart/form-data"?v=yield c.formData():v=yield c.text(),{data:v,error:null}}catch(s){return{data:null,error:s}}})}}var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nt={exports:{}};(function(n,e){var t=typeof self<"u"?self:Ir,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(o){var a={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function h(d){return d&&DataView.prototype.isPrototypeOf(d)}if(a.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(d){return d&&c.indexOf(Object.prototype.toString.call(d))>-1};function f(d){if(typeof d!="string"&&(d=String(d)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(d))throw new TypeError("Invalid character in header field name");return d.toLowerCase()}function v(d){return typeof d!="string"&&(d=String(d)),d}function _(d){var p={next:function(){var w=d.shift();return{done:w===void 0,value:w}}};return a.iterable&&(p[Symbol.iterator]=function(){return p}),p}function m(d){this.map={},d instanceof m?d.forEach(function(p,w){this.append(w,p)},this):Array.isArray(d)?d.forEach(function(p){this.append(p[0],p[1])},this):d&&Object.getOwnPropertyNames(d).forEach(function(p){this.append(p,d[p])},this)}m.prototype.append=function(d,p){d=f(d),p=v(p);var w=this.map[d];this.map[d]=w?w+", "+p:p},m.prototype.delete=function(d){delete this.map[f(d)]},m.prototype.get=function(d){return d=f(d),this.has(d)?this.map[d]:null},m.prototype.has=function(d){return this.map.hasOwnProperty(f(d))},m.prototype.set=function(d,p){this.map[f(d)]=v(p)},m.prototype.forEach=function(d,p){for(var w in this.map)this.map.hasOwnProperty(w)&&d.call(p,this.map[w],w,this)},m.prototype.keys=function(){var d=[];return this.forEach(function(p,w){d.push(w)}),_(d)},m.prototype.values=function(){var d=[];return this.forEach(function(p){d.push(p)}),_(d)},m.prototype.entries=function(){var d=[];return this.forEach(function(p,w){d.push([w,p])}),_(d)},a.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);function g(d){if(d.bodyUsed)return Promise.reject(new TypeError("Already read"));d.bodyUsed=!0}function E(d){return new Promise(function(p,w){d.onload=function(){p(d.result)},d.onerror=function(){w(d.error)}})}function P(d){var p=new FileReader,w=E(p);return p.readAsArrayBuffer(d),w}function D(d){var p=new FileReader,w=E(p);return p.readAsText(d),w}function U(d){for(var p=new Uint8Array(d),w=new Array(p.length),O=0;O<p.length;O++)w[O]=String.fromCharCode(p[O]);return w.join("")}function R(d){if(d.slice)return d.slice(0);var p=new Uint8Array(d.byteLength);return p.set(new Uint8Array(d)),p.buffer}function N(){return this.bodyUsed=!1,this._initBody=function(d){this._bodyInit=d,d?typeof d=="string"?this._bodyText=d:a.blob&&Blob.prototype.isPrototypeOf(d)?this._bodyBlob=d:a.formData&&FormData.prototype.isPrototypeOf(d)?this._bodyFormData=d:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)?this._bodyText=d.toString():a.arrayBuffer&&a.blob&&h(d)?(this._bodyArrayBuffer=R(d.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(d)||l(d))?this._bodyArrayBuffer=R(d):this._bodyText=d=Object.prototype.toString.call(d):this._bodyText="",this.headers.get("content-type")||(typeof d=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var d=g(this);if(d)return d;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(P)}),this.text=function(){var d=g(this);if(d)return d;if(this._bodyBlob)return D(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(U(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(le)}),this.json=function(){return this.text().then(JSON.parse)},this}var ae=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Y(d){var p=d.toUpperCase();return ae.indexOf(p)>-1?p:d}function M(d,p){p=p||{};var w=p.body;if(d instanceof M){if(d.bodyUsed)throw new TypeError("Already read");this.url=d.url,this.credentials=d.credentials,p.headers||(this.headers=new m(d.headers)),this.method=d.method,this.mode=d.mode,this.signal=d.signal,!w&&d._bodyInit!=null&&(w=d._bodyInit,d.bodyUsed=!0)}else this.url=String(d);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new m(p.headers)),this.method=Y(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w)}M.prototype.clone=function(){return new M(this,{body:this._bodyInit})};function le(d){var p=new FormData;return d.trim().split("&").forEach(function(w){if(w){var O=w.split("="),I=O.shift().replace(/\+/g," "),x=O.join("=").replace(/\+/g," ");p.append(decodeURIComponent(I),decodeURIComponent(x))}}),p}function X(d){var p=new m,w=d.replace(/\r?\n[\t ]+/g," ");return w.split(/\r?\n/).forEach(function(O){var I=O.split(":"),x=I.shift().trim();if(x){var ce=I.join(":").trim();p.append(x,ce)}}),p}N.call(M.prototype);function L(d,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new m(p.headers),this.url=p.url||"",this._initBody(d)}N.call(L.prototype),L.prototype.clone=function(){return new L(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},L.error=function(){var d=new L(null,{status:0,statusText:""});return d.type="error",d};var Z=[301,302,303,307,308];L.redirect=function(d,p){if(Z.indexOf(p)===-1)throw new RangeError("Invalid status code");return new L(null,{status:p,headers:{location:d}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(p,w){this.message=p,this.name=w;var O=Error(p);this.stack=O.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function V(d,p){return new Promise(function(w,O){var I=new M(d,p);if(I.signal&&I.signal.aborted)return O(new o.DOMException("Aborted","AbortError"));var x=new XMLHttpRequest;function ce(){x.abort()}x.onload=function(){var se={status:x.status,statusText:x.statusText,headers:X(x.getAllResponseHeaders()||"")};se.url="responseURL"in x?x.responseURL:se.headers.get("X-Request-URL");var ge="response"in x?x.response:x.responseText;w(new L(ge,se))},x.onerror=function(){O(new TypeError("Network request failed"))},x.ontimeout=function(){O(new TypeError("Network request failed"))},x.onabort=function(){O(new o.DOMException("Aborted","AbortError"))},x.open(I.method,I.url,!0),I.credentials==="include"?x.withCredentials=!0:I.credentials==="omit"&&(x.withCredentials=!1),"responseType"in x&&a.blob&&(x.responseType="blob"),I.headers.forEach(function(se,ge){x.setRequestHeader(ge,se)}),I.signal&&(I.signal.addEventListener("abort",ce),x.onreadystatechange=function(){x.readyState===4&&I.signal.removeEventListener("abort",ce)}),x.send(typeof I._bodyInit>"u"?null:I._bodyInit)})}return V.polyfill=!0,i.fetch||(i.fetch=V,i.Headers=m,i.Request=M,i.Response=L),o.Headers=m,o.Request=M,o.Response=L,o.fetch=V,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(nt,nt.exports);var dt=nt.exports;const ut=Dr(dt),Ve=Or({__proto__:null,default:ut},[dt]);class Lr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ut:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,h;let c=null,l=null,f=null,v=i.status,_=i.statusText;if(i.ok){if(this.method!=="HEAD"){const P=await i.text();P===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=P:l=JSON.parse(P))}const g=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),E=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&E&&E.length>1&&(f=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(c={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,f=null,v=406,_="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const g=await i.text();try{c=JSON.parse(g),Array.isArray(c)&&i.status===404&&(l=[],c=null,v=200,_="OK")}catch{i.status===404&&g===""?(v=204,_="No Content"):c={message:g}}if(c&&this.isMaybeSingle&&(!((h=c==null?void 0:c.details)===null||h===void 0)&&h.includes("Results contain 0 rows"))&&(c=null,v=200,_="OK"),c&&this.shouldThrowOnError)throw c}return{error:c,data:l,count:f,status:v,statusText:_}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,h;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(h=i==null?void 0:i.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Ur extends Lr{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),h=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${h}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Se extends Ur{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Br{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Se({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,h)=>a.concat(Object.keys(h)),[]);if(o.length>0){const a=[...new Set(o)].map(h=>`"${h}"`);this.url.searchParams.set("columns",a.join(","))}}return new Se({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const h=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(h.length>0){const c=[...new Set(h)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new Se({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Se({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Se({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Nr="1.7.1",Mr={"X-Client-Info":`postgrest-js/${Nr}`};class Fr{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Mr),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Br(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(i="HEAD",Object.entries(t).forEach(([c,l])=>{o.searchParams.append(c,`${l}`)})):(i="POST",a=t);const h=Object.assign({},this.headers);return s&&(h.Prefer=`count=${s}`),new Se({method:i,url:o,headers:h,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var Xe,Tt;function Hr(){if(Tt)return Xe;Tt=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return Xe=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),Xe}const Gr="websocket",Jr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",zr=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],qr="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Vr=["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Kr="1.0.34",Wr={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Yr="https://github.com/theturtle32/WebSocket-Node",Xr={node:">=4.0.0"},Zr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Qr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},ei={verbose:!1},ti={test:"tape test/unit/*.js",gulp:"gulp"},ri="index",ii={lib:"./lib"},si="lib/browser.js",ni="Apache-2.0",oi={name:Gr,description:Jr,keywords:zr,author:qr,contributors:Vr,version:Kr,repository:Wr,homepage:Yr,engines:Xr,dependencies:Zr,devDependencies:Qr,config:ei,scripts:ti,main:ri,directories:ii,browser:si,license:ni};var ai=oi.version,fe;if(typeof globalThis=="object")fe=globalThis;else try{fe=Hr()}catch{}finally{if(!fe&&typeof window<"u"&&(fe=window),!fe)throw new Error("Could not determine global this")}var De=fe.WebSocket||fe.MozWebSocket,li=ai;function Ft(n,e){var t;return e?t=new De(n,e):t=new De(n),t}De&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Ft,n,{get:function(){return De[n]}})});var ci={w3cwebsocket:De?Ft:null,version:li};const hi="2.7.3",di={"X-Client-Info":`realtime-js/${hi}`},ui="1.0.0",Ht=1e4,fi=1e3;var je;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(je||(je={}));var H;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(H||(H={}));var q;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(q||(q={}));var ot;(function(n){n.websocket="websocket"})(ot||(ot={}));var pe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(pe||(pe={}));class Gt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class pi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const h=r.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:h,payload:c}}}class Ze{constructor(e,t,r={},s=Ht){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Et;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Et||(Et={}));class Ie{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ie.syncState(this.state,s,i,o),this.pendingDiffs.forEach(h=>{this.state=Ie.syncDiff(this.state,h,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ie.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},h={};return this.map(i,(c,l)=>{o[c]||(h[c]=l)}),this.map(o,(c,l)=>{const f=i[c];if(f){const v=l.map(E=>E.presence_ref),_=f.map(E=>E.presence_ref),m=l.filter(E=>_.indexOf(E.presence_ref)<0),g=f.filter(E=>v.indexOf(E.presence_ref)<0);m.length>0&&(a[c]=m),g.length>0&&(h[c]=g)}else a[c]=l}),this.syncDiff(i,{joins:a,leaves:h},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,h)=>{var c;const l=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(h),l.length>0){const f=e[a].map(_=>_.presence_ref),v=l.filter(_=>f.indexOf(_.presence_ref)<0);e[a].unshift(...v)}r(a,l,h)}),this.map(o,(a,h)=>{let c=e[a];if(!c)return;const l=h.map(f=>f.presence_ref);c=c.filter(f=>l.indexOf(f.presence_ref)<0),e[a]=c,s(a,c,h),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})($||($={}));const kt=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=yi(o,n,e,s),i),{})},yi=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?Jt(i,o):at(o)},Jt=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return bi(e,t)}switch(n){case $.bool:return vi(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return gi(e);case $.json:case $.jsonb:return mi(e);case $.timestamp:return _i(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return at(e);default:return at(e)}},at=n=>n,vi=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},gi=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},mi=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},bi=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Jt(e,a))}return n},_i=n=>typeof n=="string"?n.replace(" ","T"):n;var Ot=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})},At;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(At||(At={}));var xt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(xt||(xt={}));var Ct;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ct||(Ct={}));class ft{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=H.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ze(this,q.join,this.params,this.timeout),this.rejoinTimer=new Gt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=H.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=H.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this._on(q.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ie(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const a={},h={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const f=this.bindings.postgres_changes,v=(l=f==null?void 0:f.length)!==null&&l!==void 0?l:0,_=[];for(let m=0;m<v;m++){const g=f[m],{filter:{event:E,schema:P,table:D,filter:U}}=g,R=c&&c[m];if(R&&R.event===E&&R.schema===P&&R.table===D&&R.filter===U)_.push(Object.assign(Object.assign({},g),{id:R.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return Ot(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return Ot(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=H.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(q.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Ze(this,q.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ze(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:h,leave:c,join:l}=q;if(r&&[a,h,c,l].indexOf(o)>=0&&r!==this._joinRef())return;let v=this._onMessage(o,t,r);if(t&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(_=>{var m,g,E;return((m=_.filter)===null||m===void 0?void 0:m.event)==="*"||((E=(g=_.filter)===null||g===void 0?void 0:g.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===o}).map(_=>_.callback(v,r)):(i=this.bindings[o])===null||i===void 0||i.filter(_=>{var m,g,E,P,D,U;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in _){const R=_.id,N=(m=_.filter)===null||m===void 0?void 0:m.event;return R&&((g=t.ids)===null||g===void 0?void 0:g.includes(R))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((E=t.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const R=(D=(P=_==null?void 0:_.filter)===null||P===void 0?void 0:P.event)===null||D===void 0?void 0:D.toLocaleLowerCase();return R==="*"||R===((U=t==null?void 0:t.event)===null||U===void 0?void 0:U.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===o}).map(_=>{if(typeof v=="object"&&"ids"in v){const m=v.data,{schema:g,table:E,commit_timestamp:P,type:D,errors:U}=m;v=Object.assign(Object.assign({},{schema:g,table:E,commit_timestamp:P,eventType:D,new:{},old:{},errors:U}),this._getPayloadRecords(m))}_.callback(v,r)})}_isClosed(){return this.state===H.closed}_isJoined(){return this.state===H.joined}_isJoining(){return this.state===H.joining}_isLeaving(){return this.state===H.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&ft.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(q.close,{},e)}_onError(e){this._on(q.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=H.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=kt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=kt(e.columns,e.old_record)),t}}var Qe=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const wi=()=>{};class Si{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=di,this.params={},this.timeout=Ht,this.transport=ci.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=wi,this.conn=null,this.sendBuffer=[],this.serializer=new pi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${ot.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Gt(()=>Qe(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return Qe(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return Qe(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case je.connecting:return pe.Connecting;case je.open:return pe.Open;case je.closing:return pe.Closing;default:return pe.Closed}}isConnected(){return this.connectionState()===pe.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new ft(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let o=()=>{this.encode(e,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(q.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ui}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(q.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(fi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class pt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ti extends pt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Pt extends pt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var zt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const qt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>zt(void 0,void 0,void 0,function*(){return yield(yield W(()=>Promise.resolve().then(()=>Ve),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Ei=()=>zt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield W(()=>Promise.resolve().then(()=>Ve),void 0,import.meta.url)).Response:Response});var Te=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const et=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ki=(n,e)=>Te(void 0,void 0,void 0,function*(){const t=yield Ei();n instanceof t?n.json().then(r=>{e(new Ti(et(r),n.status||500))}).catch(r=>{e(new Pt(et(r),r))}):e(new Pt(et(n),n))}),Oi=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Ke(n,e,t,r,s,i){return Te(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Oi(e,r,s,i)).then(h=>{if(!h.ok)throw h;return r!=null&&r.noResolveJson?h:h.json()}).then(h=>o(h)).catch(h=>ki(h,a))})})}function lt(n,e,t,r){return Te(this,void 0,void 0,function*(){return Ke(n,"GET",e,t,r)})}function oe(n,e,t,r,s){return Te(this,void 0,void 0,function*(){return Ke(n,"POST",e,r,s,t)})}function Ai(n,e,t,r,s){return Te(this,void 0,void 0,function*(){return Ke(n,"PUT",e,r,s,t)})}function Vt(n,e,t,r,s){return Te(this,void 0,void 0,function*(){return Ke(n,"DELETE",e,r,s,t)})}var z=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const xi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$t={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ci{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=qt(s)}uploadOrUpdate(e,t,r,s){return z(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},$t),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const h=this._removeEmptyFolders(t),c=this._getFinalPath(h),l=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return l.ok?{data:{path:h},error:null}:{data:null,error:yield l.json()}}catch(i){if(B(i))return{data:null,error:i};throw i}})}upload(e,t,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return z(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let h;const c=Object.assign({upsert:$t.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(h=new FormData,h.append("cacheControl",c.cacheControl),h.append("",r)):typeof FormData<"u"&&r instanceof FormData?(h=r,h.append("cacheControl",c.cacheControl)):(h=r,l["cache-control"]=`max-age=${c.cacheControl}`,l["content-type"]=c.contentType);const f=yield this.fetch(a.toString(),{method:"PUT",body:h,headers:l});return f.ok?{data:{path:i},error:null}:{data:null,error:yield f.json()}}catch(h){if(B(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e){return z(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield oe(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new pt("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}update(e,t,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return z(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}copy(e,t){return z(this,void 0,void 0,function*(){try{return{data:{path:(yield oe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return z(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield oe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return z(this,void 0,void 0,function*(){try{const s=yield oe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}download(e,t){return z(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield lt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(B(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",h=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});h!==""&&s.push(h);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return z(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}list(e,t,r){return z(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},xi),t),{prefix:e||""});return{data:yield oe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(B(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Pi="2.5.1",$i={"X-Client-Info":`storage-js/${Pi}`};var _e=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};class Ri{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},$i),t),this.fetch=qt(r)}listBuckets(){return _e(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return _e(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return _e(this,void 0,void 0,function*(){try{return{data:yield Ai(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}emptyBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _e(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}}class ji extends Ri{constructor(e,t={},r){super(e,t,r)}from(e){return new Ci(this.url,this.headers,e,this.fetch)}}const Ii="2.26.0",Di={"X-Client-Info":`supabase-js/${Ii}`};var Li=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const Ui=n=>{let e;return n?e=n:typeof fetch>"u"?e=ut:e=fetch,(...t)=>e(...t)},Bi=()=>typeof Headers>"u"?dt.Headers:Headers,Ni=(n,e,t)=>{const r=Ui(t),s=Bi();return(i,o)=>Li(void 0,void 0,void 0,function*(){var a;const h=(a=yield e())!==null&&a!==void 0?a:n;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${h}`),r(i,Object.assign(Object.assign({},o),{headers:c}))})};function Mi(n){return n.replace(/\/$/,"")}function Fi(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:h,global:c}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},h),s),global:Object.assign(Object.assign({},c),i)}}var ve=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};function Hi(n){return Math.round(Date.now()/1e3)+n}function Gi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const re=()=>typeof document<"u",ue={tested:!1,writable:!1},qe=()=>{if(!re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ue.tested)return ue.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ue.tested=!0,ue.writable=!0}catch{ue.tested=!0,ue.writable=!1}return ue.writable};function F(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Kt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ve(void 0,void 0,void 0,function*(){return yield(yield W(()=>Promise.resolve().then(()=>Ve),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Ji=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Pe=(n,e,t)=>ve(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),Me=(n,e)=>ve(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),tt=(n,e)=>ve(void 0,void 0,void 0,function*(){yield n.removeItem(e)});function zi(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,o,a,h,c,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)o=e.indexOf(n.charAt(l++)),a=e.indexOf(n.charAt(l++)),h=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),r=o<<2|a>>4,s=(a&15)<<4|h>>2,i=(h&3)<<6|c,t=t+String.fromCharCode(r),h!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class We{constructor(){this.promise=new We.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}We.promiseConstructor=Promise;function Rt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(zi(r))}function qi(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function Vi(n,e){return new Promise((r,s)=>{ve(this,void 0,void 0,function*(){for(let i=0;i<1/0;i++)try{const o=yield n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})})}function Ki(n){return("0"+n.toString(16)).substr(-2)}function Fe(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Ki).join("")}function Wi(n){return ve(this,void 0,void 0,function*(){const t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function Yi(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function He(n){return ve(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=yield Wi(n);return Yi(e)})}class yt extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function k(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Xi extends yt{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Zi(n){return k(n)&&n.name==="AuthApiError"}class Wt extends yt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ee extends yt{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class we extends Ee{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class rt extends Ee{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Ge extends Ee{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Q extends Ee{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class it extends Ee{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ct extends Ee{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function jt(n){return k(n)&&n.name==="AuthRetryableFetchError"}var vt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})},Qi=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Re=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),es=[502,503,504];function It(n){return vt(this,void 0,void 0,function*(){if(!Ji(n))throw new ct(Re(n),0);if(es.includes(n.status))throw new ct(Re(n),n.status);let e;try{e=yield n.json()}catch(t){throw new Wt(Re(t),t)}throw new Xi(Re(e),n.status||500)})}const ts=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function A(n,e,t,r){var s;return vt(this,void 0,void 0,function*(){const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=yield rs(n,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(h):{data:Object.assign({},h),error:null}})}function rs(n,e,t,r,s,i){return vt(this,void 0,void 0,function*(){const o=ts(e,r,s,i);let a;try{a=yield n(t,o)}catch(h){throw console.error(h),new ct(Re(h),0)}if(a.ok||(yield It(a)),r!=null&&r.noResolveJson)return a;try{return yield a.json()}catch(h){yield It(h)}})}function ne(n){var e;let t=null;os(n)&&(t=Object.assign({},n),t.expires_at=Hi(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function ye(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function is(n){return{data:n,error:null}}function ss(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=Qi(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},h=Object.assign({},o);return{data:{properties:a,user:h},error:null}}function ns(n){return n}function os(n){return n.access_token&&n.refresh_token&&n.expires_in}var K=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})},as=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class ls{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Kt(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(k(r))return{data:null,error:r};throw r}})}inviteUserByEmail(e,t={}){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ye})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return K(this,void 0,void 0,function*(){try{const{options:t}=e,r=as(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ss,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ye})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,s,i,o,a,h;return K(this,void 0,void 0,function*(){try{const c={nextPage:null,lastPage:0,total:0},l=yield A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ns});if(l.error)throw l.error;const f=yield l.json(),v=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,_=(h=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&h!==void 0?h:[];return _.length>0&&(_.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(m.split(";")[1].split("=")[1]);c[`${E}Page`]=g}),c.total=parseInt(v)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(k(c))return{data:{users:[]},error:c};throw c}})}getUserById(e){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ye})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ye})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return K(this,void 0,void 0,function*(){try{return yield A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ye})}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return K(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(k(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return K(this,void 0,void 0,function*(){try{return{data:yield A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}}const cs="2.39.0",hs="http://localhost:9999",ds="supabase.auth.token",us={"X-Client-Info":`gotrue-js/${cs}`},Dt=10,Lt={getItem:n=>qe()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{qe()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{qe()&&globalThis.localStorage.removeItem(n)}};function fs(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var T=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};fs();const ps={url:hs,storageKey:ds,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:us,flowType:"implicit",debug:!1},Je=30*1e3,Ut=3;class Le{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=Le.nextInstanceID,Le.nextInstanceID+=1,this.instanceID>0&&re()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},ps),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||Lt,this.admin=new ls({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Kt(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===Lt&&!qe()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>T(this,void 0,void 0,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return T(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=re()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),yield this._saveSession(s),setTimeout(()=>T(this,void 0,void 0,function*(){i==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return k(e)?{error:e}:{error:new Wt("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(e){var t,r,s;return T(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:l,password:f,options:v}=e;let _=null,m=null;if(this.flowType==="pkce"){const g=Fe();yield Pe(this.storage,`${this.storageKey}-code-verifier`,g),_=yield He(g),m=g===_?"plain":"s256"}i=yield A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:l,password:f,data:(t=v==null?void 0:v.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:_,code_challenge_method:m},xform:ne})}else if("phone"in e){const{phone:l,password:f,options:v}=e;i=yield A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:f,data:(r=v==null?void 0:v.data)!==null&&r!==void 0?r:{},channel:(s=v==null?void 0:v.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:ne})}else throw new Ge("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const h=o.session,c=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:c,session:h},error:null}}catch(i){if(k(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return T(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:i,password:o,options:a}=e;t=yield A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ne})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=yield A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ne})}else throw new Ge("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new rt}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,s,i;return T(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return T(this,void 0,void 0,function*(){const t=yield Me(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:ne});return yield tt(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new rt}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return T(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=yield A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ne}),{data:h,error:c}=a;return c?{data:{user:null,session:null},error:c}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new rt}:(h.session&&(yield this._saveSession(h.session),yield this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:h,error:c})}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,s,i,o;return T(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:a,options:h}=e;let c=null,l=null;if(this.flowType==="pkce"){const v=Fe();yield Pe(this.storage,`${this.storageKey}-code-verifier`,v),c=yield He(v),l=v===c?"plain":"s256"}const{error:f}=yield A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},create_user:(r=h==null?void 0:h.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:c,code_challenge_method:l},redirectTo:h==null?void 0:h.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:a,options:h}=e,{data:c,error:l}=yield A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},create_user:(i=h==null?void 0:h.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(o=h==null?void 0:h.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:l}}throw new Ge("You must provide either an email or phone number.")}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){var t,r;return T(this,void 0,void 0,function*(){try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:s,error:i}=yield A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:ne});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const o=s.session,a=s.user;return o!=null&&o.access_token&&(yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(s){if(k(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){var t,r,s;return T(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:is})}catch(i){if(k(i))return{data:null,error:i};throw i}})}reauthenticate(){return T(this,void 0,void 0,function*(){try{const{data:{session:e},error:t}=yield this.getSession();if(t)throw t;if(!e)throw new we;const{error:r}=yield A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(k(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return T(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=yield A(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=yield A(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ge("You must provide either an email or phone number and a type")}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return T(this,void 0,void 0,function*(){yield this.initializePromise,this._debug("#getSession()","begin");try{let e=null;if(this.persistSession){const i=yield Me(this.storage,this.storageKey);this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#getSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#getSession()","end")}})}getUser(e){var t,r;return T(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:i}=yield this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ye})}catch(s){if(k(s))return{data:{user:null},error:s};throw s}})}updateUser(e,t={}){return T(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)throw s;if(!r.session)throw new we;const i=r.session,{data:o,error:a}=yield A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:ye});if(a)throw a;return i.user=o.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(k(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return Rt(e)}setSession(e){return T(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new we;const t=Date.now()/1e3;let r=t,s=!0,i=null;const o=Rt(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:h}=yield this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:h}=yield this.getUser(e.access_token);if(h)throw h;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(k(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return T(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:o}=yield this.getSession();if(o)throw o;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new we;const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(k(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return T(this,void 0,void 0,function*(){try{if(!re())throw new Q("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Q("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new it("Not a valid PKCE flow url.");if(e){const E=F("code");if(!E)throw new it("No code detected.");const{data:P,error:D}=yield this.exchangeCodeForSession(E);if(D)throw D;if(!P.session)throw new it("No session detected.");let U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:P.session,redirectType:null},error:null}}const t=F("error_description");if(t){const E=F("error_code");if(!E)throw new Q("No error_code detected.");const P=F("error");throw P?new Q(t,{error:P,code:E}):new Q("No error detected.")}const r=F("provider_token"),s=F("provider_refresh_token"),i=F("access_token");if(!i)throw new Q("No access_token detected.");const o=F("expires_in");if(!o)throw new Q("No expires_in detected.");const a=F("refresh_token");if(!a)throw new Q("No refresh_token detected.");const h=F("token_type");if(!h)throw new Q("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(o),{data:f,error:v}=yield this.getUser(i);if(v)throw v;const _=f.user,m={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(o),expires_at:l,refresh_token:a,token_type:h,user:_},g=F("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:m,redirectType:g},error:null}}catch(t){if(k(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return re()&&(!!F("access_token")||!!F("error_description"))}_isPKCEFlow(){return T(this,void 0,void 0,function*(){const e=yield Me(this.storage,`${this.storageKey}-code-verifier`);return!!F("code")&&!!e})}signOut({scope:e}={scope:"global"}){var t;return T(this,void 0,void 0,function*(){const{data:r,error:s}=yield this.getSession();if(s)return{error:s};const i=(t=r.session)===null||t===void 0?void 0:t.access_token;if(i){const{error:o}=yield this.admin.signOut(i,e);if(o&&!(Zi(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(yield this._removeSession(),yield tt(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Gi(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){var t,r;return T(this,void 0,void 0,function*(){try{const{data:{session:s},error:i}=yield this.getSession();if(i)throw i;yield(t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}resetPasswordForEmail(e,t={}){return T(this,void 0,void 0,function*(){let r=null,s=null;if(this.flowType==="pkce"){const i=Fe();yield Pe(this.storage,`${this.storageKey}-code-verifier`,i),r=yield He(i),s=i===r?"plain":"s256"}try{return yield A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(k(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return T(this,void 0,void 0,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Vi(s=>T(this,void 0,void 0,function*(){return yield qi(s*200),this._debug(t,"refreshing attempt",s),yield A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ne})}),(s,i,o)=>o&&o.error&&jt(o.error)&&Date.now()+(s+1)*200-r<Je)}catch(r){if(this._debug(t,"error",r),k(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return T(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),re()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return T(this,void 0,void 0,function*(){const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield Me(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&(yield this._removeSession());return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+Dt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Dt}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=yield this._callRefreshToken(r.refresh_token);o&&(console.error(o),jt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}})}_callRefreshToken(e){var t,r;return T(this,void 0,void 0,function*(){if(!e)throw new we;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new We;const{data:i,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new we;yield this._saveSession(i.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),k(i)){const o={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}})}_notifyAllSubscribers(e,t,r=!0){return T(this,void 0,void 0,function*(){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(a=>T(this,void 0,void 0,function*(){try{yield a.callback(e,t)}catch(h){i.push(h)}}));if(yield Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}})}_saveSession(e){return T(this,void 0,void 0,function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return this._debug("#_persistSession()",e),Pe(this.storage,this.storageKey,e)}_removeSession(){return T(this,void 0,void 0,function*(){this._debug("#_removeSession()"),this.persistSession?yield tt(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&re()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return T(this,void 0,void 0,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Je);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return T(this,void 0,void 0,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return T(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return T(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return T(this,void 0,void 0,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((t.expires_at*1e3-e)/Je);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Je}ms, refresh threshold is ${Ut} ticks`),r<=Ut&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}_handleVisibilityChange(){return T(this,void 0,void 0,function*(){if(this._debug("#_handleVisibilityChange()"),!re()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>T(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return T(this,void 0,void 0,function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return T(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=Fe();yield Pe(this.storage,`${this.storageKey}-code-verifier`,s);const i=yield He(s),o=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return T(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return T(this,void 0,void 0,function*(){try{const{data:s,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:o,error:a}=yield A(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(s){if(k(s))return{data:null,error:s};throw s}})}_verify(e){var t;return T(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:i,error:o}=yield A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return T(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(k(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return T(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return T(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return T(this,void 0,void 0,function*(){const{data:{session:r},error:s}=yield this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}})}}Le.nextInstanceID=0;class ys extends Le{constructor(e){super(e)}}var vs=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function h(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):s(l.value).then(a,h)}c((r=r.apply(n,e||[])).next())})};const gs={headers:Di},ms={schema:"public"},bs={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},_s={};class ws{constructor(e,t,r){var s,i,o,a,h,c,l,f;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const v=Mi(e);this.realtimeUrl=`${v}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${v}/auth/v1`,this.storageUrl=`${v}/storage/v1`,this.functionsUrl=`${v}/functions/v1`;const _=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:ms,realtime:_s,auth:Object.assign(Object.assign({},bs),{storageKey:_}),global:gs},g=Fi(r??{},m);this.storageKey=(i=(s=g.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=g.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((h=g.auth)!==null&&h!==void 0?h:{},this.headers,(c=g.global)===null||c===void 0?void 0:c.fetch),this.fetch=Ni(t,this._getAccessToken.bind(this),(l=g.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},g.realtime)),this.rest=new Fr(`${v}/rest/v1`,{headers:this.headers,schema:(f=g.db)===null||f===void 0?void 0:f.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new jr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ji(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return vs(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o},a,h){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ys({url:this.authUrl,headers:Object.assign(Object.assign({},c),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,fetch:h})}_initRealtimeClient(e){return new Si(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ss=(n,e,t)=>new ws(n,e,t),Ts="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdham94dmpsbW5ua2tyb3Z6d2NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTkyNDMzNDgsImV4cCI6MjAzNDgxOTM0OH0.4PnzQ24S_GP45xZR_Sqe7yl4Xty0XYutBTiinZam8UM",Es="pk.eyJ1Ijoic3RhaGxzdHJhZGFtdXMiLCJhIjoiY2xvZWNrMGxjMDFldzJqczZ2b2g1c2FldCJ9.MQaEas9L_03YCaFbaO-SBA";async function ks(){try{return await(await fetch("https://raw.githubusercontent.com/stahlnypl/NYPLEnergyMap/main/static/Data/images/CensusTractbyBranch.geojson")).json()}catch(n){return console.error("Error loading Tract Data:",n),null}}function Os(n){let e,t,r,s,i,o,a,h,c,l,f,v,_='<span class="svelte-xr8x9p">NYPL Energy &amp; Sustainability Map</span>',m,g,E,P=n[1].toFixed(4)+"",D,U,R=n[2].toFixed(4)+"",N,ae,Y=n[3].toFixed(2)+"",M,le,X,L,Z,V;return{c(){e=ee("div"),t=G(`Sites Selected:
	`),r=ee("br"),s=Oe(),i=G(n[4]),o=G(" / "),a=G(n[5]),h=Oe(),c=ee("section"),l=ee("div"),f=Oe(),v=ee("div"),v.innerHTML=_,m=Oe(),g=ee("div"),E=G("Longitude: "),D=G(P),U=G(" | Latitude: "),N=G(R),ae=G(" | Zoom: "),M=G(Y),le=Oe(),X=ee("br"),L=G(`v: 1.3.3
		`),Z=ee("br"),V=G("Last Updated: 8/5/2024"),this.h()},l(d){e=te(d,"DIV",{class:!0});var p=$e(e);t=J(p,`Sites Selected:
	`),r=te(p,"BR",{}),s=Ae(p),i=J(p,n[4]),o=J(p," / "),a=J(p,n[5]),p.forEach(ie),h=Ae(d),c=te(d,"SECTION",{class:!0});var w=$e(c);l=te(w,"DIV",{class:!0}),$e(l).forEach(ie),f=Ae(w),v=te(w,"DIV",{class:!0,["data-svelte-h"]:!0}),br(v)!=="svelte-19d91ce"&&(v.innerHTML=_),m=Ae(w),g=te(w,"DIV",{class:!0});var O=$e(g);E=J(O,"Longitude: "),D=J(O,P),U=J(O," | Latitude: "),N=J(O,R),ae=J(O," | Zoom: "),M=J(O,Y),le=Ae(O),X=te(O,"BR",{}),L=J(O,`v: 1.3.3
		`),Z=te(O,"BR",{}),V=J(O,"Last Updated: 8/5/2024"),O.forEach(ie),w.forEach(ie),this.h()},h(){xe(e,"class","countSidebar svelte-xr8x9p"),xe(l,"class","svelte-xr8x9p"),xe(v,"class","header-bg svelte-xr8x9p"),xe(g,"class","sidebar svelte-xr8x9p"),xe(c,"class","svelte-xr8x9p")},m(d,p){ze(d,e,p),j(e,t),j(e,r),j(e,s),j(e,i),j(e,o),j(e,a),ze(d,h,p),ze(d,c,p),j(c,l),n[6](l),j(c,f),j(c,v),j(c,m),j(c,g),j(g,E),j(g,D),j(g,U),j(g,N),j(g,ae),j(g,M),j(g,le),j(g,X),j(g,L),j(g,Z),j(g,V)},p(d,[p]){p&16&&Ce(i,d[4]),p&32&&Ce(a,d[5]),p&2&&P!==(P=d[1].toFixed(4)+"")&&Ce(D,P),p&4&&R!==(R=d[2].toFixed(4)+"")&&Ce(N,R),p&8&&Y!==(Y=d[3].toFixed(2)+"")&&Ce(M,Y)},i:st,o:st,d(d){d&&(ie(e),ie(h),ie(c)),n[6](null)}}}const As="https://gajoxvjlmnnkkrovzwcb.supabase.co";function xs(n,e,t){const s=Ss(As,Ts,{auth:{persistSession:!1}});let i,o,a,h,c,l,f;l=" ",f=93,a=-74,h=40.7,c=10;function v(){t(3,c=o.getZoom()),t(1,a=o.getCenter().lng),t(2,h=o.getCenter().lat)}vr(async()=>{{let ir=function(S){return new Promise(C=>{if(document.querySelector(S))return C(document.querySelector(S));new MutationObserver(wt=>{document.querySelector(S)&&C(document.querySelector(S))}).observe(document.querySelector("#layerTree"),{attributes:!0,childList:!0,subtree:!1,characterData:!1})})},sr=function(){t(5,f=X.getLayers().length),t(4,l=Object.keys(o._targets).length),t(4,l-=1)};const b=await W(()=>import("./leaflet-src.d6e1ad0e.js").then(S=>S.l),[],import.meta.url);await W(()=>import("./L.Control.Locate.3995650c.js").then(S=>S.L),["./L.Control.Locate.3995650c.js","./leaflet-src.d6e1ad0e.js"],import.meta.url),await W(()=>import("./L.Control.Layers.Tree.9578f986.js"),[],import.meta.url),await W(()=>Promise.resolve({}),["../assets/L.Control.Layers.Tree.87139324.css"],import.meta.url),await W(()=>Promise.resolve({}),["../assets/leaflet-search.src.f6f51e47.css"],import.meta.url),await W(()=>import("./leaflet-search.src.13480e3f.js").then(S=>S.l),["./leaflet-search.src.13480e3f.js","./leaflet-src.d6e1ad0e.js"],import.meta.url),window.innerWidth<800?t(3,c=10):t(3,c=11);const Ye={lng:a,lat:h,zoom:c};o=b.map(i,{zoomControl:!0,maxZoom:25,minZoom:10}).setView([Ye.lat,Ye.lng],Ye.zoom),o.setMaxBounds(o.getBounds());var m=Es,g=b.tileLayer("https://api.mapbox.com/styles/v1/stahlstradamus/clrb4kx8p005v01qo3vaef7k7/tiles/{z}/{x}/{y}?access_token="+m,{attribution:'Â© <a href="https://www.mapbox.com/contribute/">Mapbox</a> Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:25}),E=b.tileLayer("https://api.mapbox.com/styles/v1/stahlstradamus/clrb52eso006901pi7jv416qa/tiles/{z}/{x}/{y}?access_token="+m,{attribution:'Â© <a href="https://www.mapbox.com/contribute/">Mapbox</a> Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:25}).addTo(o);o.on("move",()=>{v()});var P={label:"Base Maps",children:[{label:"Light Theme",layer:g},{label:"Dark Theme",layer:E}]},D={collapseAll:"",collapsed:!1};document.addEventListener("keypress",S=>{if(S.code=="Backquote"){console.log("wow!");var C=document.querySelector(".sidebar");C.style.zIndex<=0?C.style.zIndex=999:C.style.zIndex=-1}});var U=b.featureGroup(),R=b.featureGroup(),N=b.featureGroup(),ae=b.featureGroup(),Y=b.featureGroup(),M=b.featureGroup(),le=b.featureGroup(),X=b.featureGroup();b.featureGroup();var L=b.featureGroup(),Z=b.featureGroup(),V=b.featureGroup(),d=b.featureGroup(),p=b.featureGroup(),w=b.featureGroup(),O=b.featureGroup(),I=b.featureGroup(),x=b.featureGroup(),ce=b.featureGroup(),se=b.featureGroup(),ge=b.featureGroup(),gt=b.featureGroup(),mt=b.featureGroup(),bt=b.featureGroup(),_t=b.featureGroup();async function er(){const{data:S}=await s.from("EnergyDatabase").select("*");return{EnergyDatabase:S??[]}}var Ue=18,ke;o.on("zoomend",function(){var S=o.getZoom();S<Ue&&(!ke||ke>=Ue)?o.eachLayer(function(C){if(C.getTooltip()){var me=C.getTooltip();C.unbindTooltip().bindTooltip(me,{permanent:!1})}}):S>=Ue&&(!ke||ke<Ue)&&o.eachLayer(function(C){if(C.getTooltip()){var me=C.getTooltip();C.unbindTooltip().bindTooltip(me,{permanent:!0})}}),ke=S});const de=await ks();if(de){var he={style(S){switch(S.properties.HVI){case 1:return{color:"#e9c213"};case 2:return{color:"#ed9223"};case 3:return{color:"#e75d1e"};case 4:return{color:"#bd3f37"};case 5:return{color:"#7f3835"}}},weight:1,fillOpacity:.75};console.log("HVI Style: ",he),de.features.forEach(S=>{var C=S.properties.HVI;C===1&&b.geoJSON(S,he).addTo(w),C===2&&b.geoJSON(S,he).addTo(O),C===3&&b.geoJSON(S,he).addTo(I),C===4&&b.geoJSON(S,he).addTo(x),C===5&&b.geoJSON(S,he).addTo(ce)});var Yt=b.geoJSON(de,he),Be={style(S){switch(S.properties.EJ){case 1:return{color:"#C7FFAD"};case 5:return{color:"#064b00"}}},weight:.5,fillOpacity:.75};console.log("EJ style: ",Be),de.features.forEach(S=>{var C=S.properties.EJ;C===1&&b.geoJSON(S,Be).addTo(se),C===5&&b.geoJSON(S,Be).addTo(ge)});var Xt=b.geoJSON(de,Be),Ne={style(S){switch(S.properties.FZ){case 0:return{color:"#CAF0F8"};case 1:return{color:"#00B4D8"};case 2:return{color:"#0077B6"}}},weight:1,fillOpacity:.75};de.features.forEach(S=>{var C=S.properties.FZ;C===0&&b.geoJSON(S,Ne).addTo(gt),C===1&&b.geoJSON(S,Ne).addTo(mt),C===2&&b.geoJSON(S,Ne).addTo(bt)});var Zt=b.geoJSON(de,Ne)}async function tr(S,C){var me=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/branch.svg",iconSize:[15,15]}),wt=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/SASB.svg",iconSize:[15,15]}),nr=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/LPA.svg",iconSize:[15,15]}),or=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/Burg.svg",iconSize:[15,15]}),ar=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/LSC.svg",iconSize:[15,15]}),lr=b.icon({iconUrl:"https://raw.githubusercontent.com/stahlenstein/nyplehsMap/main/static/icons/270mad.svg",iconSize:[15,15]});let u=[];var cr=new b.LayerGroup;S.addLayer(cr),C.EnergyDatabase.forEach((y,Rs)=>{var be=b.tooltip([y.Y,y.X],{content:y.name,permanent:!1,direction:"auto",offset:[10,0]});y.code==="SASB"?u[y.code]=b.marker([y.Y,y.X],{icon:wt,title:y.code}).bindTooltip(be).openTooltip():y.code==="LPA"?u[y.code]=b.marker([y.Y,y.X],{icon:nr,title:y.code}).bindTooltip(be).openTooltip():y.code==="SCH"?u[y.code]=b.marker([y.Y,y.X],{icon:or,title:y.code}).bindTooltip(be).openTooltip():y.code==="LSC"?u[y.code]=b.marker([y.Y,y.X],{icon:ar,title:y.code}).bindTooltip(be).openTooltip():y.code==="TN"?u[y.code]=b.marker([y.Y,y.X],{icon:lr,title:y.code}).bindTooltip(be).openTooltip():u[y.code]=b.marker([y.Y,y.X],{icon:me,title:y.code}).bindTooltip(be).openTooltip(),y.status==="Closed"&&u[y.code].setOpacity(.25),u[y.code].alt=y.name,y.network==="W-BX"?u[y.code].addTo(U):y.network==="C-BX"?u[y.code].addTo(R):y.network==="E-BX"?u[y.code].addTo(N):y.network==="W-MH"?u[y.code].addTo(ae):y.network==="E-MH"?u[y.code].addTo(Y):y.network==="L-MH"?u[y.code].addTo(M):y.network==="SI"?u[y.code].addTo(le):y.network,y.name!=null&&u[y.code].addTo(X),y.LED_Complete=="TRUE"&&u[y.code].addTo(L),y.BMS_Complete=="TRUE"&&u[y.code].addTo(Z),y.BMS_Funding=="TRUE"&&u[y.code].addTo(_t),y.Electric_Complete=="TRUE"&&u[y.code].addTo(V),y.Solar_Complete=="TRUE"&&u[y.code].addTo(d);var pr=`
										<table>
					  <thead>
					    <tr>
					      <th colspan="2" style="padding-bottom:1em; font-size:large;">${y.name}</th>
					    </tr>
						</thead>
						<table>
						<tr>
					      <td style="text-align: left">Code: </td>
					      <td style="text-align: left">${y.code}</td>
					    </tr>
						<tr>
					      <td style="text-align: left">Network: </td>
					      <td style="text-align: left">${y.network}</td>
					    </tr>
						<tr>
					      <td style="padding-bottom: 1em; text-align: left">Status: </td>
					      <td style="padding-bottom: 1em; text-align: left">${y.status}</td>
					    </tr>
					  </table>
					  <table>
					  <tbody>
						<tr>
							<td style="text-align: right">LED Installation: </td>
							<td>${y.LED_Complete}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">LED Funding: </td>
							<td>${y.LED_Funding}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">LED Fiscal Year: </td>
							<td>${y.LED_FY}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">BMS Installation: </td>
							<td>${y.BMS_Complete}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">BMS Funding: </td>
							<td>${y.BMS_Funding}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">BMS Fiscal Year: </td>
							<td>${y.BMS_FY}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">Electric Installation: </td>
							<td>${y.Electric_Complete}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">Electric Metered: </td>
							<td>${y.Electric_Metered}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">Solar Installation: </td>
							<td>${y.Solar_Complete}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">HVI Tier: </td>
							<td>${y.HVI_Tier}</td>
					    <tr/>
						<tr>
							<td style="text-align: right">EJ Zone: </td>
							<td>${y.EJ_Zone}</td>
					    <tr/>


					  </tbody>
					</table>
					
										`;u[y.code].bindPopup(pr),ir("#layerTree").then(js=>{var yr=document.querySelectorAll('input[name="radio"]');yr[3].addEventListener("input",()=>{})})});var hr={label:"Branches",layer:X,radioGroup:"radio",children:[{label:"Networks",children:[{label:"Bronx",collapsed:!0,children:[{label:"West Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Francis Martin",layer:u.FXR},{label:"Grand Concourse",layer:u.GD},{label:"High Bridge",layer:u.HB},{label:"Jerome Park",layer:u.JP},{label:"Kingsbridge",layer:u.KBR},{label:"Melrose",layer:u.ME},{label:"Mosholu",layer:u.MO},{label:"Riverdale",layer:u.RD},{label:"Sedgwick",layer:u.SD},{label:"Spuyten Duyvil",layer:u.DY},{label:"Van Cortlandt",layer:u.VC},{label:"Woodlawn Heights",layer:u.WL}]},{label:"Central Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Allerton",layer:u.AL},{label:"Belmont",layer:u.BER},{label:"Bronx Library Center",layer:u.BLC},{label:"Clasons's Point",layer:u.CP},{label:"Hunt's Point",layer:u.HSR},{label:"Morris Park",layer:u.MP},{label:"Morrisania",layer:u.MR},{label:"Mott Haven",layer:u.MH},{label:"Pelham Parkway-Van Nest",layer:u.VN},{label:"Tremont",layer:u.TM},{label:"West Farms",layer:u.WF},{label:"Woodstock",layer:u.WO}]},{label:"East Bronx",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Baychester",layer:u.BAR},{label:"Castle Hill",layer:u.CT},{label:"City Island",layer:u.CI},{label:"Eastchester",layer:u.EA},{label:"Edenwald",layer:u.EW},{label:"Parkchester",layer:u.PKR},{label:"Pelham Bay",layer:u.PM},{label:"Soundview",layer:u.SV},{label:"Throg's Neck",layer:u.TG},{label:"Wakefield",layer:u.WK},{label:"Westchester Square",layer:u.WT}]}]},{label:"Manhattan",collapsed:!0,children:[{label:"West Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"115th St",layer:u.HU},{label:"Bloomingdale",layer:u.BLR},{label:"Columbus",layer:u.CS},{label:"Fort Washington",layer:u.FW},{label:"George Bruce",layer:u.BR},{label:"Hamilton Grange",layer:u.HG},{label:"Inwood",layer:u.INR},{label:"Macomb's Bridge",layer:u.MB},{label:"Morningside Heights",layer:u.CL},{label:"Muhlenberg",layer:u.MU},{label:"Riverside",layer:u.R},{label:"St. Agnes",layer:u.SA},{label:"Washington Heights",layer:u.WH}]},{label:"East Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"125th St",layer:u.HD},{label:"53rd St",layer:u["53STR"]},{label:"58th St",layer:u.FE},{label:"67th St",layer:u.SS},{label:"96th St",layer:u.NRS},{label:"Aguilar",layer:u.AG},{label:"Countee Cullen",layer:u.CC},{label:"Harlem",layer:u.HL},{label:"Roosevelt Island",layer:u.RI},{label:"Cathedral",layer:u.CA},{label:"Webster",layer:u.WB},{label:"Yorkville",layer:u.YV}]},{label:"Lower Manhattan",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Andrew Heiskell",layer:u.LB},{label:"Battery Park",layer:u.BPC},{label:"Chatham Square",layer:u.CHR},{label:"Epiphany",layer:u.EP},{label:"Hamilton Fish Park",layer:u.HF},{label:"Hudson Park",layer:u.HP},{label:"Jefferson Market",layer:u.JMR},{label:"Kips Bay",layer:u.KP},{label:"Mulberry St",layer:u.ML},{label:"New Amsterdam",layer:u.LM},{label:"Ottendorfer",layer:u.OT},{label:"Seward Park",layer:u.SE},{label:"Tompkin's Square",layer:u.TS}]}]},{label:"Staten Island",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Charleston",layer:u.CN},{label:"Dongan Hills",layer:u.DH},{label:"Great Kills",layer:u.GK},{label:"Huguenot Park",layer:u.HK},{label:"Mariners Harbor",layer:u.MN},{label:"New Dorp",layer:u.NDR},{label:"Port Richmond",layer:u.PR},{label:"Richmondtown",layer:u.RT},{label:"South Beach",layer:u.SB},{label:"St. George",layer:u.SGC},{label:"Stapleton",layer:u.ST},{label:"Todt Hill-Westerleigh",layer:u.THR},{label:"Tottenville",layer:u.TV},{label:"West New Brighton",layer:u.NB}]},{label:"Admin",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Library Services Center",layer:u.LSC},{label:"Library for The Performing Arts",layer:u.LPA},{label:"Schomburg",layer:u.SCH},{label:"Stavros Niarchos",layer:u.SNFL},{label:"Stephen A Schwartzman",layer:u.SASB},{label:"270 Madison",layer:u.TN}]}]},{label:"Clear Selection",layer:p,radioGroup:"radio"},{label:"Data Layers",selectAllCheckbox:!1,collapsed:!1,children:[{label:"HVI",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Heat Vulnerability Index",layer:Yt},{label:"HVI 1",layer:w},{label:"HVI 2",layer:O},{label:"HVI 3",layer:I},{label:"HVI 4",layer:x},{label:"HVI 5",layer:ce}]},{label:"EJ",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Environmental Justice Scale",layer:Xt},{label:"EJ 1",layer:se},{label:"EJ 5",layer:ge}]},{label:"FZ",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Flood Zone Scale",layer:Zt},{label:"FZ 0",layer:gt},{label:"FZ 1",layer:mt},{label:"FZ 2",layer:bt}]},{label:"LED",selectAllCheckbox:!1,collapsed:!0,children:[{label:"DCAS",layer:L},{label:"Capital",layer:L},{label:"NYPL",layer:L}]},{label:"BMS",selectAllCheckbox:!1,collapsed:!0,children:[{label:"DCAS",layer:_t},{label:"Capital",layer:Z},{label:"NYPL",layer:Z}]},{label:"Electrification",layer:V,radioGroup:"radio"},{label:"Solar",layer:d,radioGroup:"radio"}]}]};b.control.layers.tree(P,hr,D).addTo(S);var dr=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section"),ur='<div><img class="layerControlToggle" style="float:right;" src="https://raw.githubusercontent.com/stahlnypl/NYPLEHSMAP/main/static/Data/images/lct_button.png"></div>';dr.insertAdjacentHTML("afterbegin",ur);var fr=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section > div:nth-child(1)");fr.addEventListener("click",()=>{document.querySelector("div.header-bg > span").removeAttribute("leaflet-control-layers-expanded"),document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div").setAttribute("class","leaflet-control-layers leaflet-control-layers-collapsed leaflet-control")});var St=document.querySelector("div.header-bg");S.on("baselayerchange",function(y){console.log(y),y.name==="0"?(document.querySelector("body > div > main > section > div.header-bg > span").style.color="#415462",console.log("light theme")):(document.querySelector("body > div > main > section > div.header-bg > span").style.color="#dfdfdf",console.log("dark theme"))}),St.addEventListener("click",()=>{document.querySelector("body > div > main > section").removeChild(St),console.log("Title Span Clicked!")})}async function rr(){try{const S=await er();tr(o,S)}catch(S){console.error("Error: ",S)}}rr();var Qt=document.querySelector("div.leaflet-control-container > div.leaflet-top.leaflet-right");Qt.setAttribute("id","layerTree"),b.control.locate({icon:"leaflet-control-locate-location-arrow",initialZoomLevel:18}).addTo(o),window.addEventListener("click",()=>{sr()})}}),gr(async()=>{o&&(console.log("Unloading Leaflet map."),o.remove())});function _(m){mr[m?"unshift":"push"](()=>{i=m,t(0,i)})}return[i,a,h,c,l,f,_]}class Cs extends Nt{constructor(e){super(),Mt(this,e,xs,Os,Bt,{})}}function Ps(n){let e,t,r;return t=new Cs({}),{c(){e=ee("main"),_r(t.$$.fragment)},l(s){e=te(s,"MAIN",{});var i=$e(e);wr(t.$$.fragment,i),i.forEach(ie)},m(s,i){ze(s,e,i),Sr(t,e,null),r=!0},p:st,i(s){r||(Tr(t.$$.fragment,s),r=!0)},o(s){Er(t.$$.fragment,s),r=!1},d(s){s&&ie(e),kr(t)}}}class Bs extends Nt{constructor(e){super(),Mt(this,e,null,Ps,Bt,{})}}export{Bs as P,Ir as c,Dr as g};
